#!/usr/bin/env bash
set -euo pipefail

# Name of the session (used for matching + env var)
SESSION_NAME="main"

# Path to your kitty session file
SESSION_FILE="$HOME/.config/kitty/main.session"

# Export the session name so every kitty window spawned from this instance inherits it
export KITTY_SESSION="$SESSION_NAME"

# Function: check whether a kitty instance with this session is running
session_running() {
    kitty @ ls 2>/dev/null | grep -q "\"title\": *\"$SESSION_NAME\"" ||
    kitty @ ls 2>/dev/null | grep -q "\"name\": *\"$SESSION_NAME\""
}

# Exit if kitty instance with this session is already running...
if session_running; then
    exit 0
fi

# Otherwise, start a new kitty instance using your session file
kitty --title "$SESSION_NAME" \
      --session "$SESSION_FILE" &

sleep 10
kitty @ focus-tab --match index:1

#!/usr/bin/env bash
# Cycle through niri workspaces with wrapping (per-monitor)

direction="$1"

# Get workspace info as JSON
workspaces=$(niri msg -j workspaces)

# Get current workspace info
current_output=$(echo "$workspaces" | jq -r '.[] | select(.is_focused) | .output')
current_idx=$(echo "$workspaces" | jq '.[] | select(.is_focused) | .idx')

# Get min/max idx for the current monitor only
monitor_workspaces=$(echo "$workspaces" | jq --arg output "$current_output" '[.[] | select(.output == $output)]')
max=$(echo "$monitor_workspaces" | jq '[.[].idx] | max')
min=$(echo "$monitor_workspaces" | jq '[.[].idx] | min')

if [[ "$direction" == "up" ]]; then
    if [[ "$current_idx" -le "$min" ]]; then
        niri msg action focus-workspace "$max"
    else
        niri msg action focus-workspace-up
    fi
elif [[ "$direction" == "down" ]]; then
    if [[ "$current_idx" -ge "$max" ]]; then
        niri msg action focus-workspace "$min"
    else
        niri msg action focus-workspace-down
    fi
fi
